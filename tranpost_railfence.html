<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cipher Lab: Interactive Cryptography</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }

        .mono { font-family: 'Fira Code', monospace; }

        .cipher-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .grid-cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #334155;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .active-cell {
            background-color: #3b82f6;
            color: white;
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .rail-track {
            position: relative;
            height: 200px;
            overflow-x: auto;
            white-space: nowrap;
            padding: 20px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animating {
            animation: pulse 1s infinite;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <nav class="p-6 border-b border-slate-800 flex justify-between items-center sticky top-0 bg-slate-900/80 backdrop-blur-md z-50">
        <h1 class="text-2xl font-extrabold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
            CIPHER LAB
        </h1>
        <div class="flex gap-4">
            <button onclick="scrollToId('rail-fence')" class="text-sm font-medium hover:text-blue-400 transition">Rail Fence</button>
            <button onclick="scrollToId('substitution')" class="text-sm font-medium hover:text-blue-400 transition">Substitution</button>
            <button onclick="scrollToId('hybrid')" class="text-sm font-medium hover:text-blue-400 transition">Hybrid</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 mt-12 space-y-24">
        
        <!-- Intro Section -->
        <section class="text-center space-y-4">
            <h2 class="text-4xl md:text-6xl font-black">Visualize Encryption.</h2>
            <p class="text-slate-400 text-lg max-w-2xl mx-auto">
                Explore the mechanics of classical cryptography through interactive animations. See how characters move, shift, and transform.
            </p>
        </section>

        <!-- Rail Fence (Transposition) -->
        <section id="rail-fence" class="cipher-card rounded-3xl p-8">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3 space-y-6">
                    <div class="flex items-center gap-3">
                        <span class="p-2 bg-blue-500/20 text-blue-400 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="m5 12 7-7 7 7"/><path d="m5 19 7-7 7 7"/></svg>
                        </span>
                        <h3 class="text-2xl font-bold">Rail Fence Cipher</h3>
                    </div>
                    <p class="text-slate-400 text-sm">
                        A form of transposition cipher that derives its name from the way in which it is encoded. The message is written zig-zag on imaginary "rails".
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs uppercase font-bold text-slate-500 mb-2">Plaintext</label>
                            <input type="text" id="rf-input" value="HELLO WORLD" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 mono focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs uppercase font-bold text-slate-500 mb-2">Rails (2-5)</label>
                            <input type="number" id="rf-rails" min="2" max="5" value="3" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 mono focus:outline-none">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="animateRailFence('encrypt')" class="flex-1 bg-blue-600 hover:bg-blue-500 font-bold py-3 rounded-xl transition">Encrypt</button>
                            <button onclick="animateRailFence('decrypt')" class="flex-1 bg-slate-700 hover:bg-slate-600 font-bold py-3 rounded-xl transition">Decrypt</button>
                        </div>
                    </div>
                </div>

                <div class="w-full md:w-2/3 bg-slate-900/50 rounded-2xl p-6 border border-slate-800">
                    <div id="rf-viz" class="rail-track flex flex-col items-center justify-center min-h-[250px]">
                        <!-- Animation happens here -->
                        <div class="text-slate-600 italic">Enter text and click Encrypt to see the zig-zag pattern...</div>
                    </div>
                    <div class="mt-4 p-4 bg-slate-900 rounded-xl">
                        <span class="text-xs uppercase text-slate-500 font-bold">Result:</span>
                        <div id="rf-result" class="text-xl mono font-bold text-blue-400 mt-1 break-all">-</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Caesar (Substitution) -->
        <section id="substitution" class="cipher-card rounded-3xl p-8">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3 space-y-6">
                    <div class="flex items-center gap-3">
                        <span class="p-2 bg-emerald-500/20 text-emerald-400 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v4h3v7h4v-7h3v-4h-3V7h-4v3H7z"/></svg>
                        </span>
                        <h3 class="text-2xl font-bold">Substitution Cipher</h3>
                    </div>
                    <p class="text-slate-400 text-sm">
                        Specifically the Caesar Cipher. Each letter in the plaintext is replaced by a letter some fixed number of positions down the alphabet.
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs uppercase font-bold text-slate-500 mb-2">Plaintext</label>
                            <input type="text" id="sub-input" value="THE QUICK BROWN FOX" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 mono focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        </div>
                        <div>
                            <label class="block text-xs uppercase font-bold text-slate-500 mb-2">Shift (1-25)</label>
                            <input type="range" id="sub-shift" min="1" max="25" value="3" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                            <div class="text-center mt-1 text-emerald-400 mono" id="shift-val">3</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="animateSubstitution('encrypt')" class="flex-1 bg-emerald-600 hover:bg-emerald-500 font-bold py-3 rounded-xl transition">Encrypt</button>
                            <button onclick="animateSubstitution('decrypt')" class="flex-1 bg-slate-700 hover:bg-slate-600 font-bold py-3 rounded-xl transition">Decrypt</button>
                        </div>
                    </div>
                </div>

                <div class="w-full md:w-2/3 bg-slate-900/50 rounded-2xl p-6 border border-slate-800 overflow-hidden">
                    <div id="sub-viz" class="flex flex-wrap gap-2 items-center justify-center min-h-[250px]">
                        <!-- Animation happens here -->
                        <div class="text-slate-600 italic">See letters rotate through the alphabet...</div>
                    </div>
                    <div class="mt-4 p-4 bg-slate-900 rounded-xl">
                        <span class="text-xs uppercase text-slate-500 font-bold">Result:</span>
                        <div id="sub-result" class="text-xl mono font-bold text-emerald-400 mt-1 break-all">-</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hybrid Cipher -->
        <section id="hybrid" class="cipher-card rounded-3xl p-8 border-emerald-500/30">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3 space-y-6">
                    <div class="flex items-center gap-3">
                        <span class="p-2 bg-purple-500/20 text-purple-400 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg>
                        </span>
                        <h3 class="text-2xl font-bold">Hybrid (Trans + Sub)</h3>
                    </div>
                    <p class="text-slate-400 text-sm">
                        Combines both techniques: first, a Rail Fence transposition (2 rails), then a Caesar shift (+3). This significantly increases complexity.
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs uppercase font-bold text-slate-500 mb-2">Input Text</label>
                            <input type="text" id="hybrid-input" value="SECRET MESSAGE" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 mono focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="animateHybrid('encrypt')" class="flex-1 bg-purple-600 hover:bg-purple-500 font-bold py-3 rounded-xl transition">Process</button>
                        </div>
                    </div>
                </div>

                <div class="w-full md:w-2/3 bg-slate-900/50 rounded-2xl p-6 border border-slate-800">
                    <div id="hybrid-viz" class="flex flex-col gap-4 min-h-[250px] justify-center">
                        <div class="text-slate-600 italic text-center">Watch the two-stage transformation...</div>
                    </div>
                    <div class="mt-4 p-4 bg-slate-900 rounded-xl">
                        <span class="text-xs uppercase text-slate-500 font-bold">Final Ciphertext:</span>
                        <div id="hybrid-result" class="text-xl mono font-bold text-purple-400 mt-1 break-all">-</div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Overlay Message Box -->
    <div id="message-box" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-full shadow-2xl transition-all opacity-0 pointer-events-none z-[100]">
        Action complete!
    </div>

    <script>
        // Utilities
        function showMsg(txt) {
            const box = document.getElementById('message-box');
            box.innerText = txt;
            box.classList.remove('opacity-0', 'translate-y-4');
            setTimeout(() => {
                box.classList.add('opacity-0', 'translate-y-4');
            }, 2000);
        }

        function scrollToId(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        document.getElementById('sub-shift').addEventListener('input', (e) => {
            document.getElementById('shift-val').innerText = e.target.value;
        });

        // --- Rail Fence Logic ---
        async function animateRailFence(mode) {
            const text = document.getElementById('rf-input').value.replace(/\s/g, '').toUpperCase();
            const rails = parseInt(document.getElementById('rf-rails').value);
            const viz = document.getElementById('rf-viz');
            const resultDiv = document.getElementById('rf-result');
            
            if (text.length === 0) return;

            viz.innerHTML = '';
            resultDiv.innerText = 'Processing...';

            // Create Grid
            const grid = Array.from({ length: rails }, () => Array(text.length).fill(null));
            let row = 0, dir = 1;

            // Define coordinates for the zig-zag
            const coords = [];
            for (let i = 0; i < text.length; i++) {
                coords.push({ r: row, c: i });
                if (row === 0) dir = 1;
                else if (row === rails - 1) dir = -1;
                row += dir;
            }

            // UI: Create DOM grid
            viz.style.display = 'grid';
            viz.style.gridTemplateRows = `repeat(${rails}, 45px)`;
            viz.style.gridTemplateColumns = `repeat(${text.length}, 45px)`;
            viz.style.gap = '5px';

            const cells = [];
            for (let r = 0; r < rails; r++) {
                for (let c = 0; c < text.length; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell rounded-md bg-slate-800 text-slate-500 text-xs';
                    cell.id = `rf-cell-${r}-${c}`;
                    viz.appendChild(cell);
                    cells.push(cell);
                }
            }

            if (mode === 'encrypt') {
                let ciphertext = '';
                // Phase 1: Write text zig-zag
                for (let i = 0; i < text.length; i++) {
                    const { r, c } = coords[i];
                    const cell = document.getElementById(`rf-cell-${r}-${c}`);
                    cell.innerText = text[i];
                    cell.classList.add('active-cell');
                    await new Promise(r => setTimeout(r, 100));
                }

                // Phase 2: Read off rows
                await new Promise(r => setTimeout(r, 500));
                for (let r = 0; r < rails; r++) {
                    for (let c = 0; c < text.length; c++) {
                        const cell = document.getElementById(`rf-cell-${r}-${c}`);
                        if (cell.innerText) {
                            cell.classList.add('ring-2', 'ring-blue-400');
                            ciphertext += cell.innerText;
                            resultDiv.innerText = ciphertext;
                            await new Promise(r => setTimeout(r, 100));
                            cell.classList.remove('ring-2', 'ring-blue-400');
                        }
                    }
                }
                showMsg("Encryption finished!");
            } else {
                // Decrypt
                // Mark spots
                coords.forEach(({r, c}) => {
                    document.getElementById(`rf-cell-${r}-${c}`).innerText = '*';
                });

                // Fill row by row
                let charIdx = 0;
                let plaintextArr = new Array(text.length);
                for (let r = 0; r < rails; r++) {
                    for (let c = 0; c < text.length; c++) {
                        const cell = document.getElementById(`rf-cell-${r}-${c}`);
                        if (cell.innerText === '*') {
                            cell.innerText = text[charIdx];
                            cell.classList.add('active-cell');
                            charIdx++;
                            await new Promise(r => setTimeout(r, 150));
                        }
                    }
                }

                // Read zig zag
                let finalPlain = '';
                for (let i = 0; i < text.length; i++) {
                    const { r, c } = coords[i];
                    const cell = document.getElementById(`rf-cell-${r}-${c}`);
                    cell.classList.add('ring-4', 'ring-yellow-400');
                    finalPlain += cell.innerText;
                    resultDiv.innerText = finalPlain;
                    await new Promise(r => setTimeout(r, 200));
                    cell.classList.remove('ring-4', 'ring-yellow-400');
                }
                showMsg("Decryption finished!");
            }
        }

        // --- Substitution Logic ---
        async function animateSubstitution(mode) {
            const text = document.getElementById('sub-input').value.toUpperCase();
            const shift = parseInt(document.getElementById('sub-shift').value);
            const viz = document.getElementById('sub-viz');
            const resultDiv = document.getElementById('sub-result');
            
            if (!text) return;

            viz.innerHTML = '';
            resultDiv.innerText = '';
            viz.style.display = 'flex';

            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            let result = "";

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const container = document.createElement('div');
                container.className = 'flex flex-col items-center gap-1';
                
                const original = document.createElement('div');
                original.className = 'grid-cell rounded bg-slate-800 text-slate-400';
                original.innerText = char;
                
                const arrow = document.createElement('div');
                arrow.innerHTML = 'â†“';
                arrow.className = 'text-xs text-slate-600';

                const transformed = document.createElement('div');
                transformed.className = 'grid-cell rounded bg-slate-700 text-emerald-400 font-black scale-0 transition-transform duration-300';
                
                container.appendChild(original);
                container.appendChild(arrow);
                container.appendChild(transformed);
                viz.appendChild(container);

                if (alphabet.includes(char)) {
                    const oldIdx = alphabet.indexOf(char);
                    let newIdx;
                    if (mode === 'encrypt') {
                        newIdx = (oldIdx + shift) % 26;
                    } else {
                        newIdx = (oldIdx - shift + 26) % 26;
                    }
                    const newChar = alphabet[newIdx];
                    
                    // Animate
                    original.classList.add('active-cell');
                    await new Promise(r => setTimeout(r, 100));
                    transformed.innerText = newChar;
                    transformed.classList.remove('scale-0');
                    transformed.classList.add('scale-100');
                    
                    result += newChar;
                } else {
                    transformed.innerText = char;
                    transformed.classList.remove('scale-0');
                    transformed.classList.add('scale-100');
                    result += char;
                }
                
                resultDiv.innerText = result;
                await new Promise(r => setTimeout(r, 50));
            }
            showMsg(`${mode === 'encrypt' ? 'Encrypted' : 'Decrypted'} via Caesar Shift`);
        }

        // --- Hybrid Logic ---
        async function animateHybrid() {
            const text = document.getElementById('hybrid-input').value.replace(/\s/g, '').toUpperCase();
            const viz = document.getElementById('hybrid-viz');
            const resultDiv = document.getElementById('hybrid-result');
            
            if (!text) return;
            viz.innerHTML = '';
            
            // Step 1: Rail Fence (2 rails)
            const rail1 = [], rail2 = [];
            for(let i=0; i<text.length; i++) {
                if(i%2===0) rail1.push(text[i]);
                else rail2.push(text[i]);
            }
            const transposed = rail1.concat(rail2).join('');

            const row1Div = document.createElement('div');
            row1Div.className = 'flex gap-1 justify-center items-center';
            row1Div.innerHTML = `<span class="text-xs font-bold text-slate-500 mr-2">RAIL 1</span>`;
            
            const row2Div = document.createElement('div');
            row2Div.className = 'flex gap-1 justify-center items-center';
            row2Div.innerHTML = `<span class="text-xs font-bold text-slate-500 mr-2">RAIL 2</span>`;

            viz.appendChild(row1Div);
            viz.appendChild(row2Div);

            for(let i=0; i<text.length; i++) {
                const charBox = document.createElement('div');
                charBox.className = 'grid-cell rounded bg-slate-800 text-sm';
                charBox.innerText = text[i];
                if(i%2 === 0) row1Div.appendChild(charBox);
                else row2Div.appendChild(charBox);
                await new Promise(r => setTimeout(r, 100));
            }

            await new Promise(r => setTimeout(r, 500));
            const subTitle = document.createElement('div');
            subTitle.className = 'text-center text-purple-400 font-bold text-xs uppercase mt-4';
            subTitle.innerText = 'Applying Caesar Shift (+3) to Transposed Text';
            viz.appendChild(subTitle);

            const shiftRow = document.createElement('div');
            shiftRow.className = 'flex flex-wrap gap-1 justify-center mt-2';
            viz.appendChild(shiftRow);

            let final = "";
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

            for(let i=0; i<transposed.length; i++) {
                const char = transposed[i];
                const box = document.createElement('div');
                box.className = 'grid-cell rounded bg-purple-900/50 text-white text-sm scale-0 transition-all';
                shiftRow.appendChild(box);

                const newChar = alphabet[(alphabet.indexOf(char) + 3) % 26];
                box.innerText = newChar;
                box.classList.remove('scale-0');
                box.classList.add('scale-100');
                final += newChar;
                resultDiv.innerText = final;
                await new Promise(r => setTimeout(r, 100));
            }
            showMsg("Hybrid Processing Complete!");
        }

        window.onload = () => {
            console.log("Cipher Lab Initialized");
        };
    </script>
</body>
</html>