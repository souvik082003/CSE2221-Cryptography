<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hill Cipher Interactive Tutorial</title>
    <!-- Dependencies: Tailwind CSS for styling and Math.js for matrix operations -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        /* Smooth animations for step appearances */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in {
            animation: slideIn 0.6s ease-out forwards;
        }
        /* Matrix styling to look like academic notation */
        .matrix-display {
            display: inline-flex;
            flex-direction: column;
            border-left: 2px solid #1e293b;
            border-right: 2px solid #1e293b;
            padding: 0 10px;
            margin: 0 6px;
            border-radius: 8px;
            vertical-align: middle;
            background: rgba(255, 255, 255, 0.6);
        }
        .math-symbol {
            font-family: 'Cambria Math', 'serif';
            font-style: italic;
            font-weight: bold;
        }
        /* Interactive highlights */
        .eea-row:hover { background-color: #fefce8; }
        .step-card { transition: all 0.3s ease; }
        .step-card:hover { transform: scale(1.005); }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-10 text-slate-800">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10 animate-slide-in">
            <h1 class="text-5xl font-black text-slate-900 mb-3 tracking-tight">Hill Cipher Lab</h1>
            <p class="text-lg text-slate-600 max-w-2xl mx-auto">
                Step-by-step modular linear algebra for encryption and decryption.
            </p>
        </header>

        <!-- Input & Configuration Card -->
        <div class="bg-white rounded-3xl shadow-2xl p-8 mb-10 border border-slate-200 animate-slide-in" style="animation-delay: 0.1s">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-bold text-slate-500 uppercase tracking-widest mb-3">Matrix Dimensions</label>
                        <select id="matrix-size" class="w-full p-4 border-2 border-slate-200 rounded-2xl focus:border-blue-500 bg-white transition-all cursor-pointer text-lg font-semibold" onchange="initMatrix()">
                            <option value="2">2 &times; 2 (Pairing)</option>
                            <option value="3">3 &times; 3 (Triplets)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-slate-500 uppercase tracking-widest mb-3">Plaintext Input</label>
                        <input type="text" id="plaintext" placeholder="HELLO" value="HILL" class="w-full p-4 border-2 border-slate-200 rounded-2xl uppercase focus:border-blue-500 transition-all text-xl font-mono tracking-widest">
                        <p class="text-xs text-slate-400 mt-2 italic">Special characters are ignored. Padded with 'X' to match matrix size.</p>
                    </div>
                </div>

                <div class="bg-slate-50 p-6 rounded-3xl border-2 border-dashed border-slate-300 flex flex-col items-center">
                    <label class="block text-sm font-bold text-slate-500 uppercase tracking-widest mb-4">Encryption Key (K)</label>
                    <div id="matrix-container" class="grid gap-3 p-4 bg-white rounded-2xl shadow-inner">
                        <!-- Matrix Inputs Generated via JS -->
                    </div>
                    <button onclick="runLab()" class="mt-8 w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 px-8 rounded-2xl transition-all shadow-xl hover:shadow-blue-200 active:scale-95 text-lg uppercase tracking-widest">
                        Run Calculation
                    </button>
                </div>
            </div>
            
            <div id="error-box" class="mt-6 hidden p-5 bg-red-50 border-2 border-red-100 text-red-800 rounded-2xl flex items-start gap-4 animate-slide-in">
                <span class="text-2xl">⚠️</span>
                <div id="error-message"></div>
            </div>
        </div>

        <!-- Calculation Steps -->
        <div id="results" class="hidden space-y-12">
            
            <!-- Step 1: Preprocessing -->
            <section class="bg-white p-8 rounded-3xl shadow-lg border border-slate-200 animate-slide-in">
                <div class="flex items-center gap-4 mb-6">
                    <div class="bg-blue-600 text-white w-10 h-10 rounded-xl flex items-center justify-center font-black text-xl shadow-lg shadow-blue-200">1</div>
                    <h2 class="text-3xl font-extrabold text-slate-800">Preprocessing</h2>
                </div>
                <div id="s1-content" class="space-y-4"></div>
            </section>

            <!-- Step 2: EEA -->
            <section class="bg-white p-8 rounded-3xl shadow-lg border border-slate-200 animate-slide-in">
                <div class="flex items-center gap-4 mb-6">
                    <div class="bg-blue-600 text-white w-10 h-10 rounded-xl flex items-center justify-center font-black text-xl shadow-lg shadow-blue-200">2</div>
                    <h2 class="text-3xl font-extrabold text-slate-800">Extended Euclidean Algorithm</h2>
                </div>
                <div id="s2-content" class="space-y-6"></div>
            </section>

            <!-- Step 3: Key Inversion Detail -->
            <section class="bg-white p-8 rounded-3xl shadow-lg border border-slate-200 animate-slide-in">
                <div class="flex items-center gap-4 mb-6">
                    <div class="bg-blue-600 text-white w-10 h-10 rounded-xl flex items-center justify-center font-black text-xl shadow-lg shadow-blue-200">3</div>
                    <h2 class="text-3xl font-extrabold text-slate-800">Matrix Inversion Breakdown</h2>
                </div>
                <div id="s3-content" class="space-y-6"></div>
            </section>

            <!-- Step 4: Encryption -->
            <section class="bg-white p-8 rounded-3xl shadow-lg border-t-8 border-green-500 animate-slide-in">
                <div class="flex items-center gap-4 mb-6">
                    <div class="bg-green-600 text-white w-10 h-10 rounded-xl flex items-center justify-center font-black text-xl shadow-lg shadow-green-200">4</div>
                    <h2 class="text-3xl font-extrabold text-green-900">Encryption Calculation</h2>
                </div>
                <div id="s4-content" class="overflow-x-auto"></div>
            </section>

            <!-- Step 5: Decryption -->
            <section class="bg-white p-8 rounded-3xl shadow-lg border-t-8 border-orange-500 animate-slide-in">
                <div class="flex items-center gap-4 mb-6">
                    <div class="bg-orange-600 text-white w-10 h-10 rounded-xl flex items-center justify-center font-black text-xl shadow-lg shadow-orange-200">5</div>
                    <h2 class="text-3xl font-extrabold text-orange-900">Decryption Calculation</h2>
                </div>
                <div id="s5-content" class="overflow-x-auto"></div>
            </section>

        </div>
    </div>

    <script>
        const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

        // Initialize Matrix Inputs
        function initMatrix() {
            const size = parseInt(document.getElementById('matrix-size').value);
            const container = document.getElementById('matrix-container');
            container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            container.innerHTML = '';
            
            const defaults = size === 2 ? [3, 3, 2, 5] : [1, 2, 3, 0, 1, 4, 5, 6, 0];
            for (let i = 0; i < size * size; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.value = defaults[i];
                input.className = 'w-16 h-16 text-center border-2 border-slate-200 rounded-xl font-bold text-xl focus:border-blue-500 transition-all';
                input.id = `k-${i}`;
                container.appendChild(input);
            }
        }

        function mod(n, m) { return ((n % m) + m) % m; }

        function formatMatrix(m) {
            let html = `<div class="matrix-display">`;
            m.forEach(row => {
                html += `<div class="flex justify-between gap-6 font-mono text-lg">`;
                row.forEach(val => html += `<span class="w-10 text-center py-1">${val}</span>`);
                html += `</div>`;
            });
            return html + `</div>`;
        }

        // Forouzan EEA Formula implementation
        function getEEASteps(det, m) {
            let r1 = m, r2 = det, t1 = 0, t2 = 1;
            let steps = [];
            while (r2 > 0) {
                let q = Math.floor(r1 / r2);
                let r = r1 % r2;
                let t = t1 - (q * t2);
                steps.push({ q, r1, r2, r, t1, t2, t });
                r1 = r2; r2 = r; t1 = t2; t2 = t;
            }
            steps.push({ q: null, r1, r2, r: null, t1, t2, t: null });
            return { gcd: r1, t1, steps };
        }

        function runLab() {
            const size = parseInt(document.getElementById('matrix-size').value);
            const text = document.getElementById('plaintext').value.toUpperCase().replace(/[^A-Z]/g, "");
            const errorBox = document.getElementById('error-box');
            const errorMsg = document.getElementById('error-message');
            const results = document.getElementById('results');
            
            errorBox.classList.add('hidden');
            if (text.length === 0) {
                errorMsg.innerHTML = "<b>Input Error:</b> Please provide a plaintext message.";
                errorBox.classList.remove('hidden');
                return;
            }

            const K = [];
            for(let i=0; i<size; i++){
                let row = [];
                for(let j=0; j<size; j++) row.push(parseInt(document.getElementById(`k-${i*size+j}`).value));
                K.push(row);
            }

            const det = Math.round(math.det(K));
            const det26 = mod(det, 26);
            const eea = getEEASteps(det26, 26);

            if (eea.gcd !== 1) {
                errorMsg.innerHTML = `<b>Invalid Key:</b> Determinant mod 26 is <b>${det26}</b>. <br>gcd(${det26}, 26) = ${eea.gcd}. No modular inverse exists! Use a different key.`;
                errorBox.classList.remove('hidden');
                results.classList.add('hidden');
                return;
            }

            results.classList.remove('hidden');
            const invDet = mod(eea.t1, 26);

            // STEP 1 CONTENT
            let padded = text;
            while(padded.length % size !== 0) padded += "X";
            let pNums = padded.split('').map(c => ALPHABET.indexOf(c));
            document.getElementById('s1-content').innerHTML = `
                <div class="flex items-center gap-6 p-6 bg-slate-50 rounded-2xl border">
                    <div>
                        <p class="text-sm font-bold text-slate-400 mb-1">Padded Text</p>
                        <p class="text-4xl font-mono font-black tracking-widest text-blue-600">${padded}</p>
                    </div>
                    <div class="h-12 w-px bg-slate-200"></div>
                    <div class="flex gap-2">
                        ${padded.split('').map((c, i) => `
                            <div class="bg-white p-3 border rounded-xl text-center min-w-[60px] shadow-sm">
                                <p class="text-xs font-bold text-slate-300">${c}</p>
                                <p class="text-xl font-bold font-mono">${pNums[i]}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>`;

            // STEP 2 CONTENT (Forouzan Table)
            document.getElementById('s2-content').innerHTML = `
                <div class="bg-slate-50 p-6 rounded-2xl border space-y-4">
                    <p class="text-slate-600">Solving <span class="math-symbol">${det26} &middot; t₁ &equiv; 1 (mod 26)</span> using <span class="math-symbol">t = t₁ - q &middot; t₂</span></p>
                    <table class="w-full text-center border-collapse bg-white rounded-xl overflow-hidden shadow-md">
                        <thead class="bg-slate-800 text-white font-bold">
                            <tr><th class="p-3">q</th><th class="p-3">r₁</th><th class="p-3">r₂</th><th class="p-3">r</th><th class="p-3">t₁</th><th class="p-3">t₂</th><th class="p-3">t</th></tr>
                        </thead>
                        <tbody class="divide-y text-sm">
                            ${eea.steps.map((s, i) => `<tr class="eea-row ${i === eea.steps.length-1 ? 'bg-blue-50 font-black' : ''}">
                                <td class="p-3 font-mono">${s.q !== null ? s.q : '-'}</td>
                                <td class="p-3 font-mono">${s.r1}</td><td class="p-3 font-mono">${s.r2}</td><td class="p-3 font-mono">${s.r !== null ? s.r : '-'}</td>
                                <td class="p-3 font-mono ${i === eea.steps.length-1 ? 'text-blue-600' : ''}">${s.t1}</td>
                                <td class="p-3 font-mono">${s.t2}</td><td class="p-3 font-mono">${s.t !== null ? s.t : '-'}</td>
                            </tr>`).join('')}
                        </tbody>
                    </table>
                    <div class="p-4 bg-blue-600 text-white text-center rounded-xl font-bold shadow-lg">
                        d⁻¹ = ${eea.t1} mod 26 = ${invDet}
                    </div>
                </div>`;

            // STEP 3 CONTENT (Matrix Details)
            const adj = math.multiply(math.inv(K), det);
            const adjMod26 = adj.map(row => row.map(val => mod(Math.round(val), 26)));
            const K_inv = adjMod26.map(row => row.map(val => mod(val * invDet, 26)));
            
            let adjDetail = "";
            if (size === 2) {
                adjDetail = `<div class="p-4 bg-slate-50 rounded-xl border">
                    <p class="font-bold mb-2">2x2 Shortcut:</p>
                    <p class="text-sm">Swap main diagonal elements and negate anti-diagonal elements mod 26.</p>
                </div>`;
            } else {
                adjDetail = `<div class="p-4 bg-slate-50 rounded-xl border">
                    <p class="font-bold mb-2">3x3 Adjugate:</p>
                    <p class="text-sm">Calculated by taking the transpose of the cofactor matrix (minor determinants with alternating signs).</p>
                </div>`;
            }

            document.getElementById('s3-content').innerHTML = `
                ${adjDetail}
                <div class="bg-slate-900 p-8 rounded-3xl text-white shadow-2xl flex flex-col md:flex-row items-center justify-between gap-8">
                    <div class="space-y-4">
                        <p class="text-blue-400 font-bold uppercase tracking-widest text-xs">Formula</p>
                        <p class="text-2xl font-light">K⁻¹ = d⁻¹ &middot; adj(K) mod 26</p>
                    </div>
                    <div class="flex items-center gap-4 text-3xl font-mono">
                        <span>${invDet} &middot;</span>
                        ${formatMatrix(adjMod26)}
                        <span>&equiv;</span>
                        <div class="text-blue-400">${formatMatrix(K_inv)}</div>
                    </div>
                </div>`;

            // STEP 4: Encryption loop
            let s4Html = `<table class="w-full text-left rounded-xl overflow-hidden">
                <thead class="bg-slate-100 text-xs font-black uppercase text-slate-500 tracking-wider">
                    <tr><th class="p-5">Block P</th><th class="p-5">Operation [K &middot; P]</th><th class="p-5">Mod 26 Result</th><th class="p-5 text-center">Ciphertext</th></tr>
                </thead><tbody class="divide-y">`;
            let cipherString = "";
            for(let i=0; i<pNums.length; i+=size){
                let pVec = pNums.slice(i, i+size);
                let fullProd = math.multiply(K, pVec);
                let cVec = fullProd.map(v => mod(v, 26));
                let cChars = cVec.map(v => ALPHABET[v]).join('');
                cipherString += cChars;
                s4Html += `<tr>
                    <td class="p-5">${formatMatrix(pVec.map(v=>[v]))}</td>
                    <td class="p-5 text-xs font-mono">${pVec.map((v,idx)=>`R${idx+1}: ${K[idx].map((kVal,kIdx)=>`(${kVal}&middot;${pVec[kIdx]})`).join('+')} = ${fullProd[idx]}`).join('<br>')}</td>
                    <td class="p-5">${formatMatrix(cVec.map(v=>[v]))}</td>
                    <td class="p-5 text-center font-black text-3xl text-green-600">${cChars}</td>
                </tr>`;
            }
            s4Html += `</tbody></table>`;
            document.getElementById('s4-content').innerHTML = s4Html;

            // STEP 5: Decryption loop
            let s5Html = `<table class="w-full text-left rounded-xl overflow-hidden">
                <thead class="bg-slate-100 text-xs font-black uppercase text-slate-500 tracking-wider">
                    <tr><th class="p-5">Block C</th><th class="p-5">Operation [K⁻¹ &middot; C]</th><th class="p-5">Mod 26 Result</th><th class="p-5 text-center">Plaintext</th></tr>
                </thead><tbody class="divide-y">`;
            let cNums = cipherString.split('').map(c => ALPHABET.indexOf(c));
            for(let i=0; i<cNums.length; i+=size){
                let cVec = cNums.slice(i, i+size);
                let fullProd = math.multiply(K_inv, cVec);
                let dVec = fullProd.map(v => mod(v, 26));
                let pChars = dVec.map(v => ALPHABET[v]).join('');
                s5Html += `<tr>
                    <td class="p-5">${formatMatrix(cVec.map(v=>[v]))}</td>
                    <td class="p-5 text-xs font-mono">${cVec.map((v,idx)=>`R${idx+1}: ${K_inv[idx].map((kVal,kIdx)=>`(${kVal}&middot;${cVec[kIdx]})`).join('+')} = ${fullProd[idx]}`).join('<br>')}</td>
                    <td class="p-5">${formatMatrix(dVec.map(v=>[v]))}</td>
                    <td class="p-5 text-center font-black text-3xl text-orange-600">${pChars}</td>
                </tr>`;
            }
            s5Html += `</tbody></table>`;
            document.getElementById('s5-content').innerHTML = s5Html;
        }

        window.onload = initMatrix;
    </script>
</body>
</html>